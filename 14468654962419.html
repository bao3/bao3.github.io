
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>
    
  在 Vultr上安装 Arch linux - 活着真好
  

  </title>
  <meta name="author" content="">
  <meta name="description" content="">

  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link href="asset/css/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="atom.xml" rel="alternate" title="活着真好" type="application/atom+xml">
  <script src="asset/js/modernizr-2.0.js"></script>
  <script src="asset/js/jquery.min.js"></script>
  <script src="asset/highlightjs/highlight.pack.js"></script>
  <link href="asset/highlightjs/styles/solarized_light.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script>hljs.initHighlightingOnLoad();</script>

  <style type="text/css">
  .cat-children-p{ padding: 6px 0px;}
  .hljs{background: none;}
  </style>
  <script type="text/javascript">
  var isAddSildbar = true;
  </script>
  <script src="asset/js/octopress.js" type="text/javascript"></script>
</head>
<script type="text/javascript">
//链接新开窗口
function addBlankTargetForLinks () {
  $('a[href^="http"]').each(function(){
      $(this).attr('target', '_blank');
  });
}
$(document).ready(function(event) {
  addBlankTargetForLinks();
});
</script>
<body   >
  <header role="banner"><hgroup>
  <h1><a href="index.html">活着真好</a></h1>
  
    <h2></h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:bao3.org" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="index.html">Home</a></li>
  <li><a href="archives.html">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content"> 
<div>
	<article class="hentry" role="article">
	<header>
			  	<h1 class="entry-title">在 Vultr上安装 Arch linux</h1>
				<p class="meta"><time datetime="2015-11-07T11:04:56+08:00" pubdate data-updated="true">11/7</time></p>
			 </header>
		  	<div class="entry-content">
			  	<p>广告时间：在所有用过的 VPS服务商中，我一直依赖 Vultr，首先是日本线路质量比较可靠，其次价格平民，只要 <strong>5$/月</strong>（首次还送钱给你），最后就是最重要的，免费送你不限制的 Snapshot功能，让你克隆（备份）整机。所以不要由于，使用我的注册连接来注册试用（双方获利 ）：<a href="www.vultr.com/?ref=6813064">bao3的 Vultr 邀请</a></p>

<span id="more"></span><!-- more -->

<blockquote>
<p>不过也要碰运气，在你 Deploy一台新的 VPS的时候要注意看分配给你的 IP地址，虽然同样是在日本，但是从中国过去的路由会有不同所以速度也一样会有差别，你可以不断地创建和删除 VPS，直到拿到对你来说比较不错的 IP地址。<br/>
记得哦，免费且不限制的 <strong><em><strong>Snapshot</strong></em></strong> 功能可以随时克隆（备份）你的 VPS，这样你可以随时重装、还原、创建新的 VPS</p>
</blockquote>

<h1 id="toc_0">下载 iso安装盘</h1>

<p>Vultr 上支持自定义系统而不必限于已经存在的系统，所以你去<code>ISOs</code> 输入 iso的地址，让 Vultr给你下载好。我的 VPS是日本节点，所以使用了日本的地址:  </p>

<p><a href="http://ftp.jaist.ac.jp/pub/Linux/ArchLinux/iso/2015.08.01/archlinux-2015.08.01-dual.iso">http://ftp.jaist.ac.jp/pub/Linux/ArchLinux/iso/2015.08.01/archlinux-2015.08.01-dual.iso</a></p>

<p><img src="media/14468562256318/downloadISO.png" alt="downloadISO" style="width:200px;"/></p>

<h1 id="toc_1">创建系统</h1>

<p>这个应该都会了吧， Deploy 一个新的，注意先择系统时，使用你刚才下载的 iso ，不过在创建好之后系统根本不会自动安装好 Arch Linux，只不过是用光盘启动了而已。    </p>

<p><img src="media/14468562256318/vultrdeply.png" alt="vultrdeply" style="width:200px;"/></p>

<blockquote>
<p>注意一点，如果你创建的时候很不幸选了SATA （更多存储空间）那就郁闷了，因为有可能会莫名各种小毛病，影响后面的安装。<br/><br/>
我经历过，所以只建议你使用 SSD套餐<br/><br/>
并且 SATA套餐不能制作  Snapshot而 SSD可以，基于此，相当于多了一个免费的备份镜像，数据是数据是无价的。</p>
</blockquote>

<h1 id="toc_2">开始安装</h1>

<p>我相信你应该是一个具有动手能力的人，因为接下来的安装需要使用很多命令行指令。请在 VPS控制台 上选使用 VNC Console的方式来使用新创建的 VPS。  </p>

<h2 id="toc_3">硬盘分区</h2>

<p>整个安装过程中最核心的地方就是硬盘分区。原因在于 Vultr是基于 KVM的虚拟机，而我们又是用的 SSD ，所以是基于 BIOS + GPT的系统。而在默认情况下咱们的引动器 Grub只能支持 BIOS+ MBR 或者 EFI + GPT 的方式。Vultr 恰是个混合模式，会导致 Grub不引导的。<br/><br/>
 1.     首先我们必须分出一个 bios安装分区，用于存放存放标准的 Grub 的引导文件。<br/><br/>
 2.  如果你要承载 Web类服务，例如<strong>网站</strong>或者<strong>私有云</strong> ( <strong><em>owncloud</em></strong>)，那么我们最好单独分一个 Swap 。<br/><br/>
 3. 默认情况下我们直接使用剩余的 <strong>SSD</strong> 作为整个系统磁盘，不单独分区了。<br/><br/>
正面就开始咯：</p>

<pre><code class="language-shell"> gdisk /dev/vda
 n
 +2M
 回车
 EF02 （类型代码默认为 8300，要手动改）
</code></pre>

<p>截图如下：<br/><br/>
 <img src="media/14468562256318/VultrEF02.png" alt="VultrEF02"/></p>

<p>剩下的空间就是你自己自由支配，我的就仅供参考（与平时的分区没有区别），注意看图片中一定会有一个 <mark>BIOS</mark> 分区，这是成功的关键:</p>

<p><img src="media/14468562256318/VultrSSD.png" alt="VultrSSD"/></p>

<p><strong>当然最后还要写盘</strong>，这个我就不说按哪个键了。  </p>

<h2 id="toc_4">开始安装</h2>

<p>分区已经分好了，并且已经使用 ISO光盘启动了，接下来就是分区了，Arch Linux也有类似于 FreeBSD的交互式安装过程，不过在这里还是要用手动的过程，毕竟我也是第一次安装 Arch Linux 。 Vultr因为可以使用镜像来克隆，所以一次安装，永远安逸。</p>

<p>不过你需要注意的是，如果你的分区跟我不太一样，那接下来的步骤你需要有些调整，通常的调整就是 <code>/dev/vda1</code> <code>/dev/vda2</code> <code>/dev/vda3</code>这些编号有所不同。我只会依照我的来写。</p>

<pre><code> mkswap /dev/vda2 -L SWAP
 swapon /dev/vda2
 mkfs.ext4 /dev/vda3 -L ArchOS
 mount /dev/vda3 /mnt
</code></pre>

<p>好了，至此所有准备工作都已经完成了，我们开始安装系统核心了。<br/><br/>
 <code><br/>
 pacstrap /mnt base base-devel net-tools<br/>
</code><br/>
 这是要安装基本系统以及一些必要的套件，其中 <code>net-tools</code>是我额外加上的，因为这样可以在安装完使用诸如 <code>ifconfig</code> <code>nslookup</code>等等的小工具。经过等待（*通常为 2分钟 *左右），系统就已经完全OK了。</p>

<p>不过此时的系统还没有引导器 <em>bootloader</em> ,因此我们需要为系统安装一下：<br/><br/>
 <code><br/>
 arch-chroot /mnt<br/>
 pacman -Sy grub<br/>
 mkinitcpio -p linux<br/>
 grub-install /dev/vda<br/>
 grub-mkconfig -o /boot/grub/grub.cfg<br/>
</code></p>

<h2 id="toc_5">配置网络连接</h2>

<p>其实操作上来说，以上安装就已经可以重启你的 VPS 享受乐趣，不过在此之前，先要做一些小的配置。<br/>
1. 配置IP</p>

<p>如果不配置，你重启后系统会无法联网，做完这一步，以后你重启系统，就可以使用你自己的PC 的 SSH 来远程连接了。</p>

<p><code>配置DHCP</code>，这一步比较简单，在你的命令行下接着输入：</p>

<pre><code>systemctl enable dhcpcd

或者是

systemctl enable  dhcpcd@eth0

</code></pre>

<p>通常你会看到 ( Created symlink from /etc/systemd/system/multi-user.target.wants/dhcpcd.service to /usr/lib/systemd/system/dhcpcd （或者@eth0）.service.) </p>

<ol>
<li><p>重启前，记得使用 <code>passwd</code> 修改一下你的 root 密码，以利于下一步 ssh从你的 PC上登录，摆脱网页登录的烦恼</p>

<pre><code>passwd
</code></pre></li>
</ol>

<p>输入你的密码，在你输入的时候是不显示密码的，但是不用担心，这是 Linux / Unix 机制造成。</p>

<hr/>

<p>OK,启动你的机器试一下吧！</p>

<hr/>

<h2 id="toc_6">远程连接</h2>

<p>在机器重启的过程，你也不必闲着，准备一个工具，从现在开始，我们要用自己的电脑客户端来连接。如果你是 Linux / Unix / Mac ，就直接使用终端 ssh 命令 如果是 Windows 就使用 Putty 或者 Xshell ，两者都是免费的。</p>

<blockquote>
<p>提醒，SSH 连接涉及你的服务器安全，请一定要去官方网站下载工具，不要去网上找什么汉化版、修改版，以免这些工具利用你的 ssh 连接获取你的服务器密码、植入木马、作为攻击跳板等</p>
</blockquote>

<p>针对 Mac ，打开 <strong>终端</strong>，输入</p>

<pre><code class="language-shell">ssh root@your.vps.ip.address
</code></pre>

<p>使用你的 IP 地址替换后半部分，连接时会询问你是不是要添加</p>

<ul>
<li><p>安装后有还有些额外调整，但不是必需的例如 hostname, locale, timezone，你完全可以不设置重启后再慢慢调整*</p>

<h2 id="toc_7">安装 yaourt</h2>

<p>这部分是额外的设定，Arch 使用 <strong><em>pacman</em></strong>来管理包，但是有时候这些包更新慢，我们可以使用<strong><em>yaourt</em></strong> 来代替，可称为神器。我们需要修改 <code>/etc/pacman.conf</code>，使用 <code>nano /etc/pacman.conf</code> 加入以下代码：  </p></li>
</ul>

<pre><code>
    [archlinuxcn]  
    SigLevel = Optional TrustedOnly
    Server   = http://repo.archlinuxcn.org/$arch
</code></pre>

<p><code>Control + X</code> 保存( 选择 <q>yes</q> ) ，并退出<br/>
然后使用 <code>pacman -Syu yaourt</code> 安装。此后，你就可以使用 <code>yaourt -Sy  软件包名称</code>来自动使用其他用户分享的包， Enjoy~ it !</p>

<p><em>Arch 上安装 ocserv的时候，请在安装时选择手动编辑，然后去掉 autogen ，因为这货有引起编译错误导致失败。</em></p>

<p><strong><em>完结</em></strong></p>

			</div>

		
	  
		<footer>
		 <p class="meta">

			
			<span class="categories">
			 
			</span>
		    </p>
		    <p class="meta">
		      
		 </p>
	    
		<div class="sharing">
			
		</div>

	    <p class="meta">
	    
	        <a class="basic-alignment left" href="14468654962478.html" 
	        title="Previous Post: 增强 iPhone 的安全">&laquo; 增强 iPhone 的安全</a>
	    
	    
	        <a class="basic-alignment right" href="14468654962326.html" 
	        title="Next Post: 一些比较特别的 Cydia 源">一些比较特别的 Cydia 源 &raquo;</a>
	    
	    </p>
	  </footer>
	</article>
</div>
 <aside class="sidebar"> 

	<section>
	  <h1>Categories</h1>
	  <ul id="recent_posts">
	  
	        
	      </li>
	   
	  </ul>
	</section>
	<section>
	  <h1>Recent Posts</h1>
	  <ul id="recent_posts">
	  
	      
		      <li class="post">
		        <a href="14469105374435.html">测试自动更新博客</a>
		      </li>
	     
	  
	      
		      <li class="post">
		        <a href="14468654962557.html">iOS 8 按需连接 VPN的描述文件</a>
		      </li>
	     
	  
	      
		      <li class="post">
		        <a href="14468654962478.html">增强 iPhone 的安全</a>
		      </li>
	     
	  
	      
		      <li class="post">
		        <a href="14468654962419.html">在 Vultr上安装 Arch linux</a>
		      </li>
	     
	  
	      
		      <li class="post">
		        <a href="14468654962326.html">一些比较特别的 Cydia 源</a>
		      </li>
	     
	  
	      
	   
	  </ul>
	</section>
	
</aside> </div></div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 -  -
  <span class="credit">Powered by <a target="_blank" href="http://www.mweb.im">MWeb</a> &nbsp;&nbsp; Theme by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
<script src="asset/chart/all-min.js"></script><script type="text/javascript">$(function(){    var mwebii=0;    var mwebChartEleId = 'mweb-chart-ele-';    $('pre>code').each(function(){        mwebii++;        var eleiid = mwebChartEleId+mwebii;        if($(this).hasClass('language-sequence')){            var ele = $(this).addClass('nohighlight').parent();            $('<div id="'+eleiid+'"><div>').insertAfter(ele);            ele.hide();            var diagram = Diagram.parse($(this).text());            diagram.drawSVG(eleiid,{theme: 'simple'});        }else if($(this).hasClass('language-flow')){            var ele = $(this).addClass('nohighlight').parent();            $('<div id="'+eleiid+'"><div>').insertAfter(ele);            ele.hide();            var diagram = flowchart.parse($(this).text());            diagram.drawSVG(eleiid);        }    });});</script>


</body>
</html>