
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="atom.xml" rel="alternate" title="黑洞" type="application/atom+xml">
    <title> 
	  
  	Mac 上使用自动发布到 github pages - 黑洞
  	
  	</title>
    <link href="asset/css/bootstrap.min.css" rel="stylesheet">
    <link href="asset/css/style.css" rel="stylesheet">
    <script src="asset/js/jquery.min.js"></script>
    <script src="asset/js/bootstrap.min.js"></script>
    <script src="asset/js/docs.js"></script>
    <script src="asset/highlightjs/highlight.pack.js"></script>
	<link href="asset/highlightjs/styles/github.css" media="screen, projection" rel="stylesheet" type="text/css">
	<script>hljs.initHighlightingOnLoad();</script>
    <!--[if lt IE 9]>
      <script src="asset/js/html5shiv.min.js"></script>
    <![endif]-->
  </head>

  <body>

    <div class="blog-masthead">
      <div class="container">
        <nav class="blog-nav">
          <a class="blog-nav-item" id="menu-index" href="index.html">Home</a>
          <a class="blog-nav-item" id="menu-help" href="help.html">Documentation</a>
          <a class="blog-nav-item" id="menu-blog" href="all.html">Blog</a>
          <a class="blog-nav-item" id="menu-about" href="about.html">About</a>
          <a class="blog-nav-item" style="float:right;" href="http://zh.mweb.im">中文</a>
        </nav>
      </div>
    </div>

        <script type="text/javascript">
      $(function(){
      	$('#menu-blog').addClass('active');
      });
      </script>
   <div class="container" id="content-wrap">

      <div class="row">

        <div class="col-sm-8 blog-main">
			
					<div class="blog-post">
			            <h2 class="blog-post-title">Mac 上使用自动发布到 github pages</h2>
			            <p class="blog-post-meta">2016/8/2 
				            
							 
							
			            </p>
			            <div class="content-responsive">
			            <blockquote>
<p>理论上你有什么需要实时提交的 git repo 都可以使用这个方法，但为了节约，你需要设置 fswatch 的间隔时间<br/>
虽然我下面使用进行的时候使用的是 MyWeb ，其实你也可以换成其他的 Markdown 工具，效果应该差不多，只是 MyWeb 实在是方便。</p>
</blockquote>

<p>　　敝人乃懒人一枚，很久前购买了 <mark>myweb</mark> ，用来记点纯文本的笔记，偶尔发个 blog 到 <strong>github pages (github.io)</strong>。但是 myweb 是个 GUI 工具，发布到 github要换到 iTerm里自己输入命令 git add  &amp;&amp; git commit ，非常的麻烦，所以就又一次偷懒写了一个烂脚本，原则上适合用于所有的 app 自动发布到 GitHub。</p>

<h2 id="toc_0">首先， 确认你要发布的目录</h2>

<p>　　我的 mweb 发布到 Github 的文件夹是 blog，如下图所示：<br/>
<img src="media/14550024568971/14550028748116.jpg" alt="" style="width:314px;"/></p>

<p>　　先在 blog 这个目录上右击生成网站，然后再点如下图所示，找到生成网站的位置：<br/>
　　<img src="media/14550024568971/14613161793220.jpg" alt="w:100" style="width:297px;"/></p>

<p>　<br/>
　　然后生成的网站目录在 <code>/Users/bao3/Library/Containers/com.coderforart.MWeb/Data/Documents/MWeb/LocalData/Site/blog/</code>，所以我的目标就是每次文件有变化时，就自动将文章发布到 github ，记住，重点是 “有变化时” 实时更新。</p>

<h2 id="toc_1">其次,安装自动发布工具</h2>

<p>　　我们需要用到 <mark><strong>fswatch</strong></mark> 这个命令，这需要使用<code>brew install fswatch</code></p>

<p>　　可选的一个 Shell 命令是 <code>Proxychains4-ng</code>，这个东西的主要用途是为 git 命令添加代理，以防止网络质量不佳。要使用这个命令就需要有一个 Socks 代理，如果你没有，就不要安装了，而我自己有一个<code>shadowsocks-libev</code> ，所以非常方便。</p>

<h2 id="toc_2">脚本主体</h2>

<p>　　我不是个程序员，所以写出来的脚本有点“脏”，好在还能用，自己动手丰衣足食嘛；然后开始写我们的脚本吧：<br/>
找一个目录存放这个脚本，比如自己的 &ldquo;/Users/`whoami`/ &quot;下面，文件名字叫 gitblog.command ，重点是一定要是 *.command 这种结尾，后面有重要用途。</p>

<pre><code>
#!/bin/bash
#$wdir is where your github blog dir
wdir=/Users/bao3/Library/Containers/com.coderforart.MWeb/Data/Documents/MWeb/LocalData/Site/blog/
export cmd=/usr/bin/git

#locate the &#39;fswatch&#39; command ,you should install it via &quot;brew install fswatch&quot;
export fsdog=`which fswatch`
export proxy=`which proxychains4`
args=&quot;-0 -a $wdir/atom.xml&quot;
function gitpush() {
    $cmd add . ;
    reslut=$($cmd commit -a -m &quot;`date`&quot; | grep nothing)

    #when get $result length == zero ,means that there is new modified blog ,just git push  in next!
    if [ -z `$reslut` ] ; then

        #Note : proxychains4 is a proxy tools which would let &quot;git &quot; use your proxy ( shadowsocks e.g.),just brew install it OR it would skip auto.
        `$proxy -q  $cmd push -q` || `$cmd push -q`
    fi;
    return 0;
    }
cd $wdir;
#gitpush ;
export -f gitpush;
$fsdog $args | xargs -0 -n1 bash -c &#39;gitpush&#39; &amp;

exit

</code></pre>

<h3 id="toc_3">这段脚本实现的功能如下：</h3>

<ol>
<li>使用 <code>fswatch</code> <em>实时</em> 检测 myweb 的 blog 目录</li>
<li>一旦发现有新的博客文章，则会自动提交，并添加当时的时间为标记</li>
<li>提交时会优先使用 <code>Proxychains4</code> 通过代理提交，如果没安装则自动使用 Git push 提交</li>
<li>只有变化的文章才会提交，所以非常省流量</li>
<li>每次你写完博客，只需要在 Myweb 里点 下面的菜单 <br>
<img src="media/14550024568971/14550119677927.jpg" alt=""/></li>
</ol>

<h2 id="toc_4">开机启动</h2>

<p>在做这一步前，请先双击刚刚生成的 gitblog.command ，应该可以启动一个黑窗口然后又消失了。<br/>
接着，你打开 Terminal 输入下面的命令</p>

<p>$ ps waux | grep git | grep -v grep<br/>
bao3            20410      4:43下午   0:00.01 xargs -0 -n1 bash -c gitpush</p>

<p>这表示成功启动了。但如果没有，则表示你没有配置成功，多半是里面有什么特殊符号少了半边或者路径错了什么的，需要你自己调试了。</p>

<p>接下来就是在“系统偏好设置”里的“用户和群组”，加上 gitblog.command 的开机登录选项。</p>

<p><img src="media/14550024568971/14613159401465.jpg" alt=""/></p>

<p>至此，已经全部完成，每次对你的 blog 有任何更改，全都会自动更新到 github 上，非常方便。</p>

<p><mark>请你一定注意，在 MyWeb 里设置备份哟</mark></p>

			            </div>
						
			           
			          </div><!-- /.blog-post -->
			<div class="share-comment">
			
			</div>

        </div><!-- /.blog-main -->

       <!-- slider start -->  		<div class="col-sm-3 col-sm-offset-1 blog-sidebar">
          

          <div class="sidebar-module">
            <h4>About</h4>
            <p><a target="_blank" href="atom.xml">RSS</a></p>
            <p><a href="help.html">MWeb Documentation</a></p>
            

          </div>
          <div class="sidebar-module">
            <h4>Categories</h4>
            
	        
	      </li>
	   
            </ol>
          </div>

          <div class="sidebar-module">
            <h4>Recent Posts</h4>
            
	  
	      
		      
		        <a href="14910699523430.html">打造多用户 ShadowsocksR VPS 过程</a><br />
		      
	     
	  
	      
		      
		        <a href="14910533008368.html">养成使用 Mac Brew 安装软件</a><br />
		      
	     
	  
	      
		      
		        <a href="14701463847239.html">在 Vultr上安装 Arch linux</a><br />
		      
	     
	  
	      
		      
		        <a href="14701463847399.html">使用 My Chrome 订制自己的浏览器</a><br />
		      
	     
	  
	      
		      
		        <a href="14701463847475.html">优雅女性一生一定要看的50篇黄文</a><br />
		      
	     
	  
	      
		      
		        <a href="14701463847714.html">Mac 上使用自动发布到 github pages</a><br />
		      
	     
	  
	      
		      
		        <a href="14701463847780.html">Kodi(XBMC)视频播放软件</a><br />
		      
	     
	  
	      
		      
		        <a href="14701463847961.html">主题：如何处理wget mirror网站后应用程序文件名问题</a><br />
		      
	     
	  
	      
		      
		        <a href="14701463848112.html">icloud 邮件设置</a><br />
		      
	     
	  
	      
		      
		        <a href="14701463848186.html">Brew Cask 安装软件</a><br />
		      
	     
	  
	      
	  
	      
	   

          </div>
         
        </div><!-- /.blog-sidebar -->


      </div><!-- /.row -->

    </div><!-- /.container -->

  <footer class="blog-footer">
      <p>Copyright &copy; 2015
Powered by <a target="_blank" href="http://www.mweb.im">MWeb</a> &nbsp;&nbsp; 
Theme by <a target="_blank" href="http://getbootstrap.com">Bootstrap</a>、<a target="_blank" href="https://twitter.com/mdo">@mdo</a>
&nbsp;&nbsp; host on <a target="_blank" href="https://coding.net/">Coding.net Pages</a>.</p>
      <p>
        <a href="#">Back to top</a>
      </p>
    </footer>


    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="asset/js/ie10-viewport-bug-workaround.js"></script>
    


  </body>
</html>